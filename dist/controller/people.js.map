{"version":3,"sources":["../../src/controller/people.js"],"names":["config","db","api","post","authenticate","req","res","newRow","People","name","body","cat_id","cat_dis","manager","mobile","address","bankname","accountno","memo","tel","is_active","maxOrder","save","err","send","json","message","_id","get","size","page","colum","text","query","parseInt","sst","count","JSON","parse","countrow","find","data","push","limit","skip","put","findById","params","id","editRow","delete","remove","row"],"mappings":"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","file":"people.js","sourcesContent":["import { Router } from \"express\";\r\nimport People from \"../model/people\";\r\nimport { authenticate, IsAdmin } from \"../middleware/authMiddleware\";\r\n\r\nexport default ({ config, db }) => {\r\n  let api = Router();\r\n\r\n  // v1/peoples/add\r\n  api.post(\"/add\", authenticate, (req, res) => {\r\n    let newRow = new People();\r\n    newRow.name = req.body.name;\r\n    newRow.cat_id = req.body.cat_id;\r\n    if (req.body.cat_id === \"1\") {\r\n      newRow.cat_dis = \"عميل\";\r\n    } else {\r\n      newRow.cat_dis = \"مورد\";\r\n    }\r\n    newRow.manager = req.body.manager;\r\n    newRow.mobile = req.body.mobile;\r\n    newRow.address = req.body.address;\r\n    newRow.bankname = req.body.bankname;\r\n    newRow.accountno = req.body.accountno;\r\n    newRow.memo = req.body.memo;\r\n    newRow.tel = req.body.tel;\r\n    newRow.is_active = req.body.is_active;\r\n    newRow.maxOrder = req.body.maxOrder;\r\n    newRow.save(err => {\r\n      if (err) {\r\n        res.send(err);\r\n      } else {\r\n        res.json({ message: \"saved\", _id: newRow._id });\r\n      }\r\n    });\r\n  });\r\n\r\n\r\n  // v1/peoples/   -> get all data\r\n  api.get(\"/\", (req, res) => {\r\n    let size = 20;\r\n    let page = 0;\r\n    let colum = \"\";\r\n    let text = \"\";\r\n    (req.query.page) ? page = parseInt(req.query.page) : page = 0;\r\n    (req.query.size) ? size = parseInt(req.query.size) : size = 20;\r\n    (req.query.colum) ? colum = (req.query.colum) : colum = \"\";\r\n    (req.query.text) ? text = (req.query.text) : text = \"\";\r\n\r\n    if ((colum) && (text)) {\r\n      const sst = '{ \"' + colum + '\": { \"$regex\": \"' + text + '\" , \"$options\": \"i\" } }';\r\n      People.count(JSON.parse(sst), (err, countrow) => {\r\n        People.find(JSON.parse(sst), (err, data) => {\r\n          if (err) {\r\n            res.send(err);\r\n          }\r\n          data.push({\r\n            'row_count': countrow\r\n          });\r\n          res.json(data);\r\n        }).limit(size).skip(size * page);\r\n      });\r\n    } else {\r\n      People.count((err, countrow) => {\r\n        People.find((err, data) => {\r\n          if (err) {\r\n            res.send(err);\r\n          }\r\n          data.push({\r\n            'row_count': countrow\r\n          });\r\n          res.json(data);\r\n        }).limit(size).skip(size * page);\r\n      });\r\n\r\n    }\r\n\r\n  });\r\n\r\n\r\n  // /v1/peoples/:id    -- put\r\n  api.put(\"/:id\", authenticate, (req, res) => {\r\n    People.findById(req.params.id, (err, editRow) => {\r\n      if (err) {\r\n        res.send(err);\r\n      } else {\r\n        editRow.name = req.body.name;\r\n        editRow.cat_id = req.body.cat_id;\r\n        if (req.body.cat_id === \"1\") {\r\n          editRow.cat_dis = \"عميل\";\r\n        } else {\r\n          editRow.cat_dis = \"مورد\";\r\n        }\r\n        editRow.manager = req.body.manager;\r\n        editRow.mobile = req.body.mobile;\r\n        editRow.address = req.body.address;\r\n        editRow.bankname = req.body.bankname;\r\n        editRow.accountno = req.body.accountno;\r\n        editRow.memo = req.body.memo;\r\n        editRow.tel = req.body.tel;\r\n        editRow.is_active = req.body.is_active;\r\n        editRow.maxOrder = req.body.maxOrder;\r\n        editRow.save(err => {\r\n          if (err) {\r\n            res.send(err);\r\n          } else {\r\n            res.json({ message: \"update\" });\r\n          }\r\n        });\r\n      }\r\n    });\r\n  });\r\n\r\n\r\n  // /v1/Peoples/:id    -- delete\r\n  api.delete(\"/:id\", authenticate, (req, res) => {\r\n    People.remove({ _id: req.params.id }, (err, row) => {\r\n      if (err) {\r\n        res.send(err);\r\n      }\r\n      res.json({ message: \"remove\" });\r\n    });\r\n  });\r\n  //====================================================\r\n\r\n  return api;\r\n};\r\n"]}