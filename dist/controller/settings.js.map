{"version":3,"sources":["../../src/controller/settings.js"],"names":["config","db","api","get","req","res","Settings","countDocuments","err","c","send","newSetting","name","save","json","findOne","doc","put","authenticate","IsAdmin","general","body","vat","tel","memo","address","branch_no","main_branch","vat_ok","vat_rate","vat_for_all","expiration_date_required","direct_sale","has_discount","discount_rate","sell_old_first","short_invoice","message"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;kBAEe,gBAAoB;AAAA,QAAjBA,MAAiB,QAAjBA,MAAiB;AAAA,QAATC,EAAS,QAATA,EAAS;;AAC/B,QAAIC,MAAM,sBAAV;;AAGA;AACA;AACAA,QAAIC,GAAJ,CAAQ,GAAR,EAAc,UAACC,GAAD,EAAMC,GAAN,EAAc;AACxBC,2BAASC,cAAT,CAAwB,EAAxB,EAA4B,UAACC,GAAD,EAAKC,CAAL,EAAU;AAClC,gBAAID,GAAJ,EAAS;AACLH,oBAAIK,IAAJ,CAASF,GAAT;AACH,aAFD,MAEO;AACJ;AACA,oBAAIC,MAAI,CAAR,EAAW;AACP,wBAAIE,aAAa,IAAIL,kBAAJ,EAAjB;AACAK,+BAAWC,IAAX,GAAkB,YAAlB;AACAD,+BAAWE,IAAX,CAAgB,eAAO;AACnB,4BAAIL,GAAJ,EAAS;AACLH,gCAAIK,IAAJ,CAASF,GAAT;AACH;AACDH,4BAAIS,IAAJ,CAAUH,UAAV;AACH,qBALD;AAMH,iBATD,MASO;AACHL,uCAASS,OAAT,CAAiB,EAAjB,EAAqB,UAAUP,GAAV,EAAeQ,GAAf,EAAoB;AACrCX,4BAAIS,IAAJ,CAASE,GAAT;AACH,qBAFD;AAGH;AAEH;AACJ,SArBD;AAsBH,KAvBD;;AAyBA;AACAd,QAAIe,GAAJ,CAAQ,GAAR,EAAaC,4BAAb,EAA2BC,uBAA3B,EAAsC,UAACf,GAAD,EAAMC,GAAN,EAAc;AAChDC,2BAASS,OAAT,CAAiB,EAAjB,EAAqB,UAACP,GAAD,EAAMY,OAAN,EAAkB;AACnC,gBAAIZ,GAAJ,EAAS;AACLH,oBAAIK,IAAJ,CAASF,GAAT;AACH;AACDY,oBAAQR,IAAR,GAAeR,IAAIiB,IAAJ,CAAST,IAAxB;AACAQ,oBAAQE,GAAR,GAAclB,IAAIiB,IAAJ,CAASC,GAAvB;AACAF,oBAAQG,GAAR,GAAcnB,IAAIiB,IAAJ,CAASE,GAAvB;AACAH,oBAAQI,IAAR,GAAepB,IAAIiB,IAAJ,CAASG,IAAxB;AACAJ,oBAAQK,OAAR,GAAkBrB,IAAIiB,IAAJ,CAASI,OAA3B;AACAL,oBAAQM,SAAR,GAAoBtB,IAAIiB,IAAJ,CAASK,SAA7B;AACAN,oBAAQO,WAAR,GAAsBvB,IAAIiB,IAAJ,CAASM,WAA/B;AACAP,oBAAQQ,MAAR,GAAiBxB,IAAIiB,IAAJ,CAASO,MAA1B;AACAR,oBAAQS,QAAR,GAAmBzB,IAAIiB,IAAJ,CAASQ,QAA5B;AACAT,oBAAQU,WAAR,GAAsB1B,IAAIiB,IAAJ,CAASS,WAA/B;AACAV,oBAAQW,wBAAR,GAAmC3B,IAAIiB,IAAJ,CAASU,wBAA5C;AACAX,oBAAQY,WAAR,GAAsB5B,IAAIiB,IAAJ,CAASW,WAA/B;AACAZ,oBAAQa,YAAR,GAAuB7B,IAAIiB,IAAJ,CAASY,YAAhC;AACAb,oBAAQc,aAAR,GAAwB9B,IAAIiB,IAAJ,CAASa,aAAjC;AACAd,oBAAQe,cAAR,GAAyB/B,IAAIiB,IAAJ,CAASc,cAAlC;AACAf,oBAAQgB,aAAR,GAAwBhC,IAAIiB,IAAJ,CAASe,aAAjC;;AAEAhB,oBAAQP,IAAR,CAAa,eAAO;AAChB,oBAAIL,GAAJ,EAAS;AACLH,wBAAIK,IAAJ,CAASF,GAAT;AACH;AACDH,oBAAIS,IAAJ,CAAS,EAAEuB,SAAS,QAAX,EAAT;AACH,aALD;AAMH,SA3BD;AA4BH,KA7BD;AA8BA;AACA,WAAOnC,GAAP;AACH,C","file":"settings.js","sourcesContent":["import { Router } from \"express\";\r\nimport Settings from \"../model/settings\";\r\nimport { respond, authenticate, IsAdmin } from \"../middleware/authMiddleware\";\r\n\r\nexport default ({ config, db }) => {\r\n    let api = Router();\r\n\r\n\r\n    //   v1/settings/              ->   git settings\r\n    // authenticate, IsAdmin,\r\n    api.get(\"/\",  (req, res) => {\r\n        Settings.countDocuments({}, (err,c )=>{\r\n            if (err) {\r\n                res.send(err);\r\n            } else {\r\n               // res.json(allusers);\r\n               if (c===0 ){\r\n                   let newSetting = new Settings();\r\n                   newSetting.name = 'اسم الفرع ' ;\r\n                   newSetting.save(err => {\r\n                       if (err) {\r\n                           res.send(err);\r\n                       }\r\n                       res.json( newSetting );\r\n                   });\r\n               } else {\r\n                   Settings.findOne({}, function (err, doc) {\r\n                       res.json(doc) ;\r\n                   });\r\n               }\r\n               \r\n            }\r\n        });\r\n    });\r\n \r\n    // /v1/users/:id    --> edit user data\r\n    api.put(\"/\", authenticate, IsAdmin ,  (req, res) => {\r\n        Settings.findOne({}, (err, general) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            general.name = req.body.name;\r\n            general.vat = req.body.vat;\r\n            general.tel = req.body.tel;\r\n            general.memo = req.body.memo;\r\n            general.address = req.body.address;\r\n            general.branch_no = req.body.branch_no;\r\n            general.main_branch = req.body.main_branch;\r\n            general.vat_ok = req.body.vat_ok; \r\n            general.vat_rate = req.body.vat_rate;\r\n            general.vat_for_all = req.body.vat_for_all;\r\n            general.expiration_date_required = req.body.expiration_date_required;\r\n            general.direct_sale = req.body.direct_sale;\r\n            general.has_discount = req.body.has_discount;\r\n            general.discount_rate = req.body.discount_rate;\r\n            general.sell_old_first = req.body.sell_old_first;\r\n            general.short_invoice = req.body.short_invoice;\r\n            \r\n            general.save(err => {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n                res.json({ message: \"update\" });\r\n            });\r\n        });\r\n    });\r\n    // <========================================================> \\\\\r\n    return api;\r\n};\r\n"]}